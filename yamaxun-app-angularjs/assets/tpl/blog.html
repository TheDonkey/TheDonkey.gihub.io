<article>
        <header>
            <h1>AJAX+JSON 在Web-IM 系统中的应用</h1>
            <address>
                <strong>张刚，詹舒波</strong>
                <span>北京邮电大学网络与交换技术国家重点实验室，北京 100876</span>
            </address>
            <p>即时消息传递正在改变人们的生活。它是一个非常有用的工具，结合了电子邮件、 Internet 电话以及文件传输应用程序的优点。用户甚至可以看到谁在线、谁的状态为“忙碌” 等等。当然了，人们可以用它来长时间地进行不创造任何效益的聊天。但是，员工也可以利用它在任何时候向老板发送极为重要的信息。伴随着
                WEB2.0 时代的到来，即时消息和 WEB 应用程序强强联手，必将掀起一股狂潮。本文就是借助一些较新 web 技术，对此的一些尝试和探索。
            </p>
            <p>计算机通信;即时消息;异步传输;JSON;Web2.0;JavaScript</p>
            <p>TP311</p>
        </header>
        <header lang="en">
            <h1>Application of AJAX and JSON in Web-IM System</h1>
            <address>
                <strong>ZHANG Gang, ZHAN Shubo</strong>
                <span>State Key Laboratory of Networking and Switching, Beijing University of Posts and
Telecommunications,Beijing 100876</span>
            </address>
            <p>Instant messaging is changing people's lives. It is a very useful tool. It has advantages of the E-mail, Internet
                Telephony and File Transfer application. Users can even see who is online,who's status is "busy" and so on.
                Of course, one can not get any benefit, if we waste a lot of time only to chat. However, employees can also
                use it to send some important information to his boss at any time . With the advent of Web2.0, combining
                the strengths of instant messaging and WEB applications will set off a craze. This article is to use some
                of the newer web technologies to do some attempts and exploration.
            </p>
            <p>Computer Communication;IM;Ajax;Javascript;Json;Web2.0</p>
        </header>

        <section class="forward">
            <h2>引言</h2>
            <p>
                现如今，即时消息的应用之多，好比满天星辰。各种WEB 聊天工具，客户服务系统如 雨后春笋般的出现：百度hi 和阿里巴巴的旺旺，人人网，GMAIL，网易邮箱也有相应的聊 天系统。本文正是在研究使用以上聊天系统和桌面版聊天应用程序的基础上，利用AJAX
                和 JSON 来对WEB 版聊天系统进行一些探索，实现和应用。
            </p>
        </section>
        <section class="ajax">
            <h2>AJAX 简介</h2>
            <p><abbr title="Asynchronous JavaScript and XML">AJAX</abbr> 即<cite>Asynchronous JavaScript and XML</cite>（异步JavaScript
                和XML)，是指一种创建 交互式网页应用的网页开发技术<sup><a href="#li1">[1]</a></sup><sup><a href="li3">[3]</a></sup>。
            </p>
            <p>现通常将应用程序分为桌面应用程序和 Web 应用程序。桌面应用程序，通常以CD 为 介质并完全安装到计算机上，可以使用互联网下载更新，但运行这些应用程序的代码在桌面 计算机上，其表现为运行，交互一般很快，具有漂亮的用户界面和非凡的动态性。
            </p>
            <p>而 web 应用程序运行在某处的web 服务器上，要通过web 浏览器访问这种应用程序， 它们提供了在桌面上不能实现的服务（例如Amazon.com 和eBay）。但是，伴随着web 的强大出现的是等待：等待服务器响应，等待屏幕刷新，等待请求返回和生成新的页面。在此情
                况下，AJAX 诞生了。其目标就是使Web 应用程序具有桌面应用程序的功能和交互性，可 以使用像桌面应用程序中常见的动态用户界面和漂亮控件。
            </p>
            <p>AJAX 应用程序所用到的基本技术主要包括：</p>
            <div class="sno1">
                <p>HTML 用于建立 Web 表单并确定应用程序其他部分使用的字段。</p>
                <p>JavaScript 是运行 AJAX 应用程序的核心，帮助改进与服务器应用程序的通信。</p>
                <p>DHTML 或 Dynamic HTML，用于动态更新表单。</p>
                <p>文档对象模型 DOM 用于处理 HTML 结构和服务器返回的 XML。</p>
            </div>
            <p>其相关的联系如下：</p>
            <figure>
                <img src="assets/images/pic1.jpg" alt="pic1">
                <figcaption>AJAX 各技术元素关系图</figcaption>
            </figure>
            <p>其工作原理如下图所示<sup><a href="#li3">[3]</a></sup>：</p>
            <figure>
                <img src="assets/images/pic2.jpg" alt="pic2">
                <figcaption>AJAX 工作原理图</figcaption>
            </figure>
        </section>

        <section class="JSON">
            <h2>JSON 的介绍</h2>
            <p>JSON(JavaScript Object Notation) 是一种轻量级的数据交换格式。易于人阅读和编写， 同时也易于机器解析和生成。它基于JavaScript 的一个子集。</p>
            <p>
                JSON 采用完全独立于语言的文本格式，其结构分为两种：
            </p>
            <div class="sno2">
                <p>
                    “名称/值”对的集合（A collection of name/value pairs）
                </p>
                <p>
                    值的有序列表（An ordered list of values）。
                </p>
            </div>
            <p>
                虽然 XML 和JSON 两者在可读性，可扩展性，编解码等特点上不相上下，但是对于服 务器与 JavaScript 的交互来说，JSON 似乎是一个天然的选择。因为，对于普通的 Web 应用，开发者经常为 XML 的解析伤透了脑筋，无论是服务器端生成或处理
                XML，还是客户 端用 JavaScript 解析 XML，都常常导致复杂的代码，极低的开发效率。而且，对于大多数 Web 应用来说，他们根本不需要复杂的 XML 来传输数据，XML 的扩展性很少具有优势， 许多
                AJAX 应用甚至直接返回 HTML 片段来构建动态 Web 页面。虽然，返回 HTML 片 段大大降低了系统的复杂性，但同时缺少了一定的灵活性。而同 XML 或 HTML 片段相比， JSON 提供了更好的简单性和灵活性。
            </p>
        </section>

        <section class="ajax-operate">
            <h2>
                AJAX 客户端操作
            </h2>
            <p>AJAX 通过Http 与服务器建立连接，向服务器端发送数据并将服务器的响应信息返回， 其基本操作：
            </p>
            <div class="sno3">
                <p>
                    用JavaScript 来创建XMLHttpRequest 对象，该对象向服务器发送一个HTTP 请求<sup><a href="#li5">[5]</a></sup>。
                </p>
                <p>
                    通过open(method,url,asynchronous,username,pwd)方法设置请求的参数，但并不向服 务器发送。
                </p>
                <p>
                    设置XMLHttpRequest 对象的onreadystatechange 属性，处理服务器响应。
                </p>
                <p>
                    通过 send(body) 方法向服务器发送请求。
                </p>
            </div>
        </section>

        <section class="design">
            <h2>设计与实现</h2>
            <section class="des1">
                <h3>一个简略的 IM 系统流程</h3>
                <p>流程如下图所示：</p>
                <figure>
                    <img src="assets/images/pic3.jpg" alt="pic3">
                    <figcaption>简单IM 系统流程</figcaption>
                </figure>
                <p>各模块基本功能：</p>
                <div class="sno4">
                    <p>“状态的改变”和“消息的发送”两个模块，主要用于组织状态和信息的消息。</p>
                    <p>“状态的接收”和“消息的接收”两个模块，用于处理好友状态的改变和获的好友 发送来的信息，并加以呈现。
                    </p>
                    <p>“消息处理”模块，是一个消息队列，客户端的每个消息都添加到这个队列上，然 后按照一定的时间间隔通过AJAX 发向服务器。</p>
                    <p>服务器端，主要根据客户端发送来的数据，进行解析，对于不同的请求，进行不同 的处理，并返回相应的信息。
                    </p>
                    <p>由于 Web 系统请求-响应的特点，要想即时获得好友状态的改变和发送来的信息， 需要定时的发送“状态的接收”和“消息的接收”请求，这些都在这两个模块中进
                    </p>
                </div>
            </section>

            <section class="des2">
                <h3>IM 中AJAX 应用分析</h3>
                <p>
                    IM 系统需要实时的查看所有好友的状态和能够即时接收到好友发送来的消息，并能将 自身的状态实时呈现给好友。由于Web 请求-响应的特点以及页面刷新等造成的问题，显然 不能满足IM 系统的要求，但是借助AJAX+JavaScript 的帮助，我们就能很好的解决这些问
                    题了：通过AJAX 在后台异步发送消息（使用者并不知道）和JavaScript 操作DOM 局部更新<sup><a href="#li4">[4]</a></sup>。
                </p>
            </section>

            <section class="des3">
                <h3>消息队列应用实现</h3>
                <p>消息队列的基本流程如图 4 所示：</p>
                <figure>
                    <img src="assets/images/pic4.jpg" alt="pic4">
                    <figcaption>消息队列基本流程图</figcaption>
                </figure>
                <div class="sno5">
                    <p>消息队列采用对象数组的形式进行。</p>
                    <p>当用户登录时，消息队列同时启动，接收客户端各模块发送来信息，并间隔一定时 间向服务器发送请求。
                    </p>
                    <p>对 AJAX 的各种操作进行封装，并解决跨浏览器等问题，以便适用于不同的客户端。 对发送的请求和接收的响应消息以及中间的出现的任何情况进行记录，方便调试。
                    </p>
                </div>
            </section>
        </section>

        <section class="summary">
            <h2>总结</h2>
            <p>目前，在Web-IM 中使用的技术，主要包括AJAX 和OCX 控件两种方式。虽然OCX 方式相 比较前者而言，在即时性以及实现上都比前者优秀，但是由于相当一部分浏览器对OCX 并不 支持，而且，使用者对于安装OCX
                插件，存在一定的恐惧心理，所以此种方式并不受到多大 的追捧。有理由相信，随着DOM，JavaScript 等标准进一步规范和各种新技术的不断成熟， AJAX 在IM 系统中的应用将更加顺手和普遍。</p>
        </section>

        <footer>
            <h4>[参考文献] (References)</h4>
            <ul>
                <li id="li1">吕林霞,张明新. 基于WEB 挖掘的专业文本特征提取方法研究[J ]. 兰州石化职业技术学院学报, 2007, 7(3) : 33 -351.</li>
                <li id="li2">John Resig.Pro JavaScript Techniques.人民邮电出版社.</li>
                <li id="li3">曾伟辉,李森.基于JavaScript 切片的框架网络爬虫技术研究[J].计算机系统应用, 2009,7:169-171.</li>
                <li id="li4">J.J.Garrett.A New Approach to Web Application.http://www.adaptivepath.com/ideas/essays/,2005.</li>
                <li id="li5">王映,于满泉,李盛韬,王斌,余智华.JavaScript 引擎在动态网页采集技术中的应用.计算机应 用,2004,24(2):33-36.
                </li>
                <li id="li6">Woolston D．Pro Ajax and the NET 2．0 Platform[M]．LosAngeles，California，USA：Wager T Press， 2006．
                </li>
            </ul>
        </footer>


    </article>